46c4e89d649fa230c2612a52d69e2190
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const AuthUserSearchByEmail_1 = __importDefault(require("../search-by-email/AuthUserSearchByEmail"));
class Authenticator {
    constructor(authUserRepository, authTokenRepository, eventBus) {
        this.authTokenRepository = authTokenRepository;
        this.eventBus = eventBus;
        this.authUserSearcherByEmail = new AuthUserSearchByEmail_1.default(authUserRepository);
    }
    run(email, password) {
        return __awaiter(this, void 0, void 0, function* () {
            const authUser = yield this.authUserSearcherByEmail.search(email);
            authUser.authenticate(password);
            this.eventBus.publish(authUser.pullDomainEvents());
            return this.authTokenRepository.generate(authUser);
        });
    }
}
exports.default = Authenticator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2N1YXRyb29jaGVudGEvTWFnaWNTaG9wcGVyL21hZ2ljc2hvcHBlci1ub2RlL3NyYy9tb2R1bGVzL2F1dGgvYXBwbGljYXRpb24vbG9naW4vQXV0aGVudGljYXRvci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQU1BLHFHQUE2RTtBQUU3RSxNQUFxQixhQUFhO0lBRTlCLFlBQ0ksa0JBQXNDLEVBQ3JCLG1CQUF3QyxFQUN4QyxRQUFrQjtRQURsQix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO1FBQ3hDLGFBQVEsR0FBUixRQUFRLENBQVU7UUFFbkMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLElBQUksK0JBQXFCLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUNqRixDQUFDO0lBRUssR0FBRyxDQUFDLEtBQW9CLEVBQUUsUUFBMEI7O1lBQ3RELE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVsRSxRQUFRLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRWhDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUE7WUFFbEQsT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZELENBQUM7S0FBQTtDQUNKO0FBbkJELGdDQW1CQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvY3VhdHJvb2NoZW50YS9NYWdpY1Nob3BwZXIvbWFnaWNzaG9wcGVyLW5vZGUvc3JjL21vZHVsZXMvYXV0aC9hcHBsaWNhdGlvbi9sb2dpbi9BdXRoZW50aWNhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBFdmVudEJ1cyBmcm9tICdAbWljcm9rL2V2ZW50L2RvbWFpbi9FdmVudEJ1cyc7XG5pbXBvcnQgQXV0aFRva2VuIGZyb20gJy4uLy4uL2RvbWFpbi9BdXRoVG9rZW4nO1xuaW1wb3J0IEF1dGhUb2tlblJlcG9zaXRvcnkgZnJvbSAnLi4vLi4vZG9tYWluL0F1dGhUb2tlblJlcG9zaXRvcnknO1xuaW1wb3J0IEF1dGhVc2VyRW1haWwgZnJvbSAnLi4vLi4vZG9tYWluL0F1dGhVc2VyRW1haWwnO1xuaW1wb3J0IEF1dGhVc2VyUGFzc3dvcmQgZnJvbSAnLi4vLi4vZG9tYWluL0F1dGhVc2VyUGFzc3dvcmQnO1xuaW1wb3J0IHsgQXV0aFVzZXJSZXBvc2l0b3J5IH0gZnJvbSAnLi4vLi4vZG9tYWluL0F1dGhVc2VyUmVwb3NpdG9yeSc7XG5pbXBvcnQgQXV0aFVzZXJTZWFyY2hCeUVtYWlsIGZyb20gJy4uL3NlYXJjaC1ieS1lbWFpbC9BdXRoVXNlclNlYXJjaEJ5RW1haWwnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRoZW50aWNhdG9yIHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IGF1dGhVc2VyU2VhcmNoZXJCeUVtYWlsOiBBdXRoVXNlclNlYXJjaEJ5RW1haWw7XG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIGF1dGhVc2VyUmVwb3NpdG9yeTogQXV0aFVzZXJSZXBvc2l0b3J5LFxuICAgICAgICBwcml2YXRlIHJlYWRvbmx5IGF1dGhUb2tlblJlcG9zaXRvcnk6IEF1dGhUb2tlblJlcG9zaXRvcnksXG4gICAgICAgIHByaXZhdGUgcmVhZG9ubHkgZXZlbnRCdXM6IEV2ZW50QnVzLFxuICAgICkge1xuICAgICAgICB0aGlzLmF1dGhVc2VyU2VhcmNoZXJCeUVtYWlsID0gbmV3IEF1dGhVc2VyU2VhcmNoQnlFbWFpbChhdXRoVXNlclJlcG9zaXRvcnkpO1xuICAgIH1cblxuICAgIGFzeW5jIHJ1bihlbWFpbDogQXV0aFVzZXJFbWFpbCwgcGFzc3dvcmQ6IEF1dGhVc2VyUGFzc3dvcmQpOiBQcm9taXNlPEF1dGhUb2tlbj4ge1xuICAgICAgICBjb25zdCBhdXRoVXNlciA9IGF3YWl0IHRoaXMuYXV0aFVzZXJTZWFyY2hlckJ5RW1haWwuc2VhcmNoKGVtYWlsKTtcblxuICAgICAgICBhdXRoVXNlci5hdXRoZW50aWNhdGUocGFzc3dvcmQpO1xuXG4gICAgICAgIHRoaXMuZXZlbnRCdXMucHVibGlzaChhdXRoVXNlci5wdWxsRG9tYWluRXZlbnRzKCkpXG5cbiAgICAgICAgcmV0dXJuIHRoaXMuYXV0aFRva2VuUmVwb3NpdG9yeS5nZW5lcmF0ZShhdXRoVXNlcik7XG4gICAgfVxufVxuIl0sInZlcnNpb24iOjN9