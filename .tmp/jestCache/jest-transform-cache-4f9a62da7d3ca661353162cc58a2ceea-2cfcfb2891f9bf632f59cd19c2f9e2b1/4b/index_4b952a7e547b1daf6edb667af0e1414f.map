{"file":"/Users/cuatroochenta/MagicShopper/magicshopper-node/src/microk/docs/openapi/index.ts","mappings":"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","names":[],"sources":["/Users/cuatroochenta/MagicShopper/magicshopper-node/src/microk/docs/openapi/index.ts"],"sourcesContent":["import fs from 'fs';\nimport glob from 'glob';\nimport mergeWith from 'lodash.mergewith';\nimport { OpenAPIObject } from 'openapi3-ts';\nimport {\n    ComponentsObject,\n    ExternalDocumentationObject,\n    InfoObject,\n    PathsObject,\n    SecurityRequirementObject,\n    ServerObject,\n    TagObject,\n} from 'openapi3-ts/src/model/OpenApi';\nimport path from 'path';\nimport { getOnlyComments } from './consumers/GetOnlyComments';\nimport { jsdocInfo } from './consumers/jsDocInfo';\nimport { parseJsonCommentsFromYaml } from './consumers/parseJsonCommentsFromYaml';\nimport { parseYamlComments } from './consumers/parseYamlComments';\n\nexport type OpenApiConfig = {\n    baseDir: string,\n    filesPattern: string,\n\n    info: InfoObject;\n    servers?: ServerObject[];\n    paths?: PathsObject;\n    components?: ComponentsObject;\n    security?: SecurityRequirementObject[];\n    tags?: TagObject[];\n    externalDocs?: ExternalDocumentationObject;\n}\n\nexport default class OpenApi {\n    private static DEFAULT_EXCLUDED_FOLDER = 'node_modules';\n    private static DEFAULT_GLOB_OPTIONS = { ignore: '**/node_modules/**' };\n\n    constructor(\n        private readonly config: OpenApiConfig,\n    ) {\n    }\n\n    globFilesMatches = (\n        baseDir: string,\n        filesPattern: string,\n        excludedFolder: string = OpenApi.DEFAULT_EXCLUDED_FOLDER,\n    ) => {\n        try {\n            const files = glob.sync(path.resolve(baseDir, filesPattern), OpenApi.DEFAULT_GLOB_OPTIONS);\n            return files.filter((file) => !file.includes(excludedFolder));\n        } catch (error) {\n            throw new Error('Error Glob Files');\n        }\n    }\n\n    readFile(filePath: string): string {\n        return fs.readFileSync(filePath).toString();\n    }\n\n    readFiles(files: string[]): string[] {\n        if (!files || !Array.isArray(files)) {\n            return [];\n        }\n        return files.map((file) => this.readFile(file));\n    }\n\n    mergeDeep(first, second) {\n        return mergeWith({}, first, second, (x, y) => (y === null ? x : undefined));\n    }\n\n    removeEmptyKeys(obj) {\n        if (!obj) {\n            return {};\n        }\n        Object.keys(obj).forEach((key) => {\n            if (obj[key] === undefined) {\n                delete obj[key];\n            }\n        });\n        return obj;\n    }\n\n    generateDocs(): OpenAPIObject {\n        const files = this.globFilesMatches(this.config.baseDir, this.config.filesPattern);\n        const fileContents = this.readFiles(files);\n        const comments = getOnlyComments(fileContents);\n        const jsDocInfo = jsdocInfo()(comments)\n        const yamlComments = parseYamlComments(jsDocInfo)\n        const jsonComments = parseJsonCommentsFromYaml(yamlComments)\n\n        const openApi: OpenAPIObject = this.removeEmptyKeys({\n            openapi: '3.0.0',\n            info: this.config.info,\n            servers: this.config.servers,\n            paths: this.config.paths || {},\n            components: {\n                ...this.config.components,\n                schemas: this.config.components.schemas || {},\n            },\n            security: this.config.security,\n            tags: this.config.tags,\n            externalDocs: this.config.externalDocs,\n        });\n\n        for (const jsonComment of jsonComments) {\n            for (const key of Object.keys(jsonComment)) {\n                if (key.startsWith('/')) {\n                    openApi.paths[key] = this.mergeDeep(openApi.paths[key], jsonComment[key]);\n                } else {\n                    openApi.components.schemas[key] = jsonComment[key];\n                }\n            }\n        }\n\n        return openApi;\n    }\n}\n"],"version":3}