72dbf428e82987e982813c4b69f4a1aa
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypeOrmRepository = void 0;
const TypeOrmCriteriaConverter_1 = __importDefault(require("./TypeOrmCriteriaConverter"));
class TypeOrmRepository {
    constructor(_client) {
        this._client = _client;
        this.criteriaConverter = new TypeOrmCriteriaConverter_1.default();
    }
    client() {
        return this._client;
    }
    repository() {
        return __awaiter(this, void 0, void 0, function* () {
            return (yield this._client).getRepository(this.entitySchema());
        });
    }
    persist(aggregateRoot) {
        return __awaiter(this, void 0, void 0, function* () {
            const repository = yield this.repository();
            yield repository.save(aggregateRoot);
        });
    }
    searchByCriteria(criteria) {
        return __awaiter(this, void 0, void 0, function* () {
            const repository = yield this.repository();
            const findOptions = this.criteriaConverter.convert(criteria);
            return repository.find(findOptions);
        });
    }
    searchOneByCriteria(criteria) {
        return __awaiter(this, void 0, void 0, function* () {
            const repository = yield this.repository();
            const findOptions = this.criteriaConverter.convert(criteria);
            return repository.findOne(findOptions);
        });
    }
}
exports.TypeOrmRepository = TypeOrmRepository;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2N1YXRyb29jaGVudGEvTWFnaWNTaG9wcGVyL21hZ2ljc2hvcHBlci1ub2RlL3NyYy9taWNyb2svcGVyc2lzdGVuY2UvaW5mcmFzdHJ1Y3R1cmUvdHlwZW9ybS9UeXBlT3JtUmVwb3NpdG9yeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFJQSwwRkFBa0U7QUFFbEUsTUFBc0IsaUJBQWlCO0lBRW5DLFlBQW9CLE9BQTRCO1FBQTVCLFlBQU8sR0FBUCxPQUFPLENBQXFCO1FBRC9CLHNCQUFpQixHQUFHLElBQUksa0NBQXdCLEVBQUUsQ0FBQztJQUVwRSxDQUFDO0lBSVMsTUFBTTtRQUNaLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUN4QixDQUFDO0lBRWUsVUFBVTs7WUFDdEIsT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQztRQUNuRSxDQUFDO0tBQUE7SUFFZSxPQUFPLENBQUMsYUFBZ0I7O1lBQ3BDLE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQzNDLE1BQU0sVUFBVSxDQUFDLElBQUksQ0FBQyxhQUFvQixDQUFDLENBQUM7UUFDaEQsQ0FBQztLQUFBO0lBRVksZ0JBQWdCLENBQUMsUUFBa0I7O1lBQzVDLE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQzNDLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDN0QsT0FBTyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3hDLENBQUM7S0FBQTtJQUVZLG1CQUFtQixDQUFDLFFBQWtCOztZQUMvQyxNQUFNLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUMzQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzdELE9BQU8sVUFBVSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMzQyxDQUFDO0tBQUE7Q0FDSjtBQS9CRCw4Q0ErQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2N1YXRyb29jaGVudGEvTWFnaWNTaG9wcGVyL21hZ2ljc2hvcHBlci1ub2RlL3NyYy9taWNyb2svcGVyc2lzdGVuY2UvaW5mcmFzdHJ1Y3R1cmUvdHlwZW9ybS9UeXBlT3JtUmVwb3NpdG9yeS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb25uZWN0aW9uLCBFbnRpdHlTY2hlbWEsIFJlcG9zaXRvcnkgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IEFnZ3JlZ2F0ZVJvb3QgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vQWdncmVnYXRlUm9vdCc7XG5pbXBvcnQgeyBDcml0ZXJpYSB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9jcml0ZXJpYS9Dcml0ZXJpYSc7XG5pbXBvcnQgeyBOdWxsYWJsZSB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9OdWxsYWJsZSc7XG5pbXBvcnQgVHlwZU9ybUNyaXRlcmlhQ29udmVydGVyIGZyb20gJy4vVHlwZU9ybUNyaXRlcmlhQ29udmVydGVyJztcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFR5cGVPcm1SZXBvc2l0b3J5PFQgZXh0ZW5kcyBBZ2dyZWdhdGVSb290PiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBjcml0ZXJpYUNvbnZlcnRlciA9IG5ldyBUeXBlT3JtQ3JpdGVyaWFDb252ZXJ0ZXIoKTtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9jbGllbnQ6IFByb21pc2U8Q29ubmVjdGlvbj4pIHtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgZW50aXR5U2NoZW1hKCk6IEVudGl0eVNjaGVtYTxUPjtcblxuICAgIHByb3RlY3RlZCBjbGllbnQoKTogUHJvbWlzZTxDb25uZWN0aW9uPiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jbGllbnQ7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIHJlcG9zaXRvcnkoKTogUHJvbWlzZTxSZXBvc2l0b3J5PFQ+PiB7XG4gICAgICAgIHJldHVybiAoYXdhaXQgdGhpcy5fY2xpZW50KS5nZXRSZXBvc2l0b3J5KHRoaXMuZW50aXR5U2NoZW1hKCkpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBhc3luYyBwZXJzaXN0KGFnZ3JlZ2F0ZVJvb3Q6IFQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgcmVwb3NpdG9yeSA9IGF3YWl0IHRoaXMucmVwb3NpdG9yeSgpO1xuICAgICAgICBhd2FpdCByZXBvc2l0b3J5LnNhdmUoYWdncmVnYXRlUm9vdCBhcyBhbnkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBzZWFyY2hCeUNyaXRlcmlhKGNyaXRlcmlhOiBDcml0ZXJpYSk6IFByb21pc2U8TnVsbGFibGU8VFtdPj4ge1xuICAgICAgICBjb25zdCByZXBvc2l0b3J5ID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5KCk7XG4gICAgICAgIGNvbnN0IGZpbmRPcHRpb25zID0gdGhpcy5jcml0ZXJpYUNvbnZlcnRlci5jb252ZXJ0KGNyaXRlcmlhKTtcbiAgICAgICAgcmV0dXJuIHJlcG9zaXRvcnkuZmluZChmaW5kT3B0aW9ucyk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIHNlYXJjaE9uZUJ5Q3JpdGVyaWEoY3JpdGVyaWE6IENyaXRlcmlhKTogUHJvbWlzZTxOdWxsYWJsZTxUPj4ge1xuICAgICAgICBjb25zdCByZXBvc2l0b3J5ID0gYXdhaXQgdGhpcy5yZXBvc2l0b3J5KCk7XG4gICAgICAgIGNvbnN0IGZpbmRPcHRpb25zID0gdGhpcy5jcml0ZXJpYUNvbnZlcnRlci5jb252ZXJ0KGNyaXRlcmlhKTtcbiAgICAgICAgcmV0dXJuIHJlcG9zaXRvcnkuZmluZE9uZShmaW5kT3B0aW9ucyk7XG4gICAgfVxufVxuIl0sInZlcnNpb24iOjN9