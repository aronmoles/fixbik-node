{"version":3,"sources":["/Users/cuatroochenta/MagicShopper/magicshopper-node/src/microk/persistence/infrastructure/typeorm/TypeOrmRepository.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAA,0BAAA;AAAA;AAAA,2BAAA,eAAA,CAAA,OAAA,CAAA,4BAAA,CAAA,CAAA,CAAA;;AAEA,MAAsB,iBAAtB,CAAuC;AAGnC,EAAA,WAAA,CAAoB,OAApB,EAAgD;AAAA;AAAA;AAAA;AAA5B,SAAA,OAAA,GAAA,OAAA;;AAA4B;AAAA;AAF/B,SAAA,iBAAA,GAAoB,IAAI,0BAAA,CAAA,OAAJ,EAApB;AAGhB;;AAIS,EAAA,MAAM,GAAA;AAAA;AAAA;AAAA;AACZ,WAAO,KAAK,OAAZ;AACH;;AAEe,EAAA,UAAU,GAAA;AAAA;AAAA;AAAA;;;;;AACtB,aAAO,CAAC,MAAM,KAAK,OAAZ,EAAqB,aAArB,CAAmC,KAAK,YAAL,EAAnC,CAAP;AACH,K;AAAA;;AAEe,EAAA,OAAO,CAAC,aAAD,EAAiB;AAAA;AAAA;AAAA;;;;AACpC,YAAM,UAAU;AAAA;AAAA,iCAAG,MAAM,KAAK,UAAL,EAAT,CAAhB;;;;AACA,YAAM,UAAU,CAAC,IAAX,CAAgB,aAAhB,CAAN;AACH,K;AAAA;;AAEY,EAAA,gBAAgB,CAAC,QAAD,EAAmB;AAAA;AAAA;AAAA;;;;AAC5C,YAAM,UAAU;AAAA;AAAA,iCAAG,MAAM,KAAK,UAAL,EAAT,CAAhB;AACA,YAAM,WAAW;AAAA;AAAA,iCAAG,KAAK,iBAAL,CAAuB,OAAvB,CAA+B,QAA/B,CAAH,CAAjB;;;;AACA,aAAO,UAAU,CAAC,IAAX,CAAgB,WAAhB,CAAP;AACH,K;AAAA;;AAEY,EAAA,mBAAmB,CAAC,QAAD,EAAmB;AAAA;AAAA;AAAA;;;;AAC/C,YAAM,UAAU;AAAA;AAAA,iCAAG,MAAM,KAAK,UAAL,EAAT,CAAhB;AACA,YAAM,WAAW;AAAA;AAAA,iCAAG,KAAK,iBAAL,CAAuB,OAAvB,CAA+B,QAA/B,CAAH,CAAjB;;;;AACA,aAAO,UAAU,CAAC,OAAX,CAAmB,WAAnB,CAAP;AACH,K;AAAA;;AA/BkC;;;;AAAvC,OAAA,CAAA,iBAAA,GAAA,iBAAA","sourcesContent":["import { Connection, EntitySchema, Repository } from 'typeorm';\nimport { AggregateRoot } from '../../../common/AggregateRoot';\nimport { Criteria } from '../../../common/criteria/Criteria';\nimport { Nullable } from '../../../common/Nullable';\nimport TypeOrmCriteriaConverter from './TypeOrmCriteriaConverter';\n\nexport abstract class TypeOrmRepository<T extends AggregateRoot> {\n    private readonly criteriaConverter = new TypeOrmCriteriaConverter();\n\n    constructor(private _client: Promise<Connection>) {\n    }\n\n    protected abstract entitySchema(): EntitySchema<T>;\n\n    protected client(): Promise<Connection> {\n        return this._client;\n    }\n\n    protected async repository(): Promise<Repository<T>> {\n        return (await this._client).getRepository(this.entitySchema());\n    }\n\n    protected async persist(aggregateRoot: T): Promise<void> {\n        const repository = await this.repository();\n        await repository.save(aggregateRoot as any);\n    }\n\n    public async searchByCriteria(criteria: Criteria): Promise<Nullable<T[]>> {\n        const repository = await this.repository();\n        const findOptions = this.criteriaConverter.convert(criteria);\n        return repository.find(findOptions);\n    }\n\n    public async searchOneByCriteria(criteria: Criteria): Promise<Nullable<T>> {\n        const repository = await this.repository();\n        const findOptions = this.criteriaConverter.convert(criteria);\n        return repository.findOne(findOptions);\n    }\n}\n"]}