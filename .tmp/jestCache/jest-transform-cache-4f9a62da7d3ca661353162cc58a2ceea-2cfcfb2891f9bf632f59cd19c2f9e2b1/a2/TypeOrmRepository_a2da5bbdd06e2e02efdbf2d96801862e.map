{"file":"/Users/cuatroochenta/MagicShopper/magicshopper-node/src/microk/persistence/infrastructure/typeorm/TypeOrmRepository.ts","mappings":";;;;;;;;;;;;;;;AAIA,0FAAkE;AAElE,MAAsB,iBAAiB;IAEnC,YAAoB,OAA4B;QAA5B,YAAO,GAAP,OAAO,CAAqB;QAD/B,sBAAiB,GAAG,IAAI,kCAAwB,EAAE,CAAC;IAEpE,CAAC;IAIS,MAAM;QACZ,OAAO,IAAI,CAAC,OAAO,CAAC;IACxB,CAAC;IAEe,UAAU;;YACtB,OAAO,CAAC,MAAM,IAAI,CAAC,OAAO,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC;QACnE,CAAC;KAAA;IAEe,OAAO,CAAC,aAAgB;;YACpC,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;YAC3C,MAAM,UAAU,CAAC,IAAI,CAAC,aAAoB,CAAC,CAAC;QAChD,CAAC;KAAA;IAEY,gBAAgB,CAAC,QAAkB;;YAC5C,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;YAC3C,MAAM,WAAW,GAAG,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAC7D,OAAO,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACxC,CAAC;KAAA;IAEY,mBAAmB,CAAC,QAAkB;;YAC/C,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,UAAU,EAAE,CAAC;YAC3C,MAAM,WAAW,GAAG,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAC7D,OAAO,UAAU,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QAC3C,CAAC;KAAA;CACJ;AA/BD,8CA+BC","names":[],"sources":["/Users/cuatroochenta/MagicShopper/magicshopper-node/src/microk/persistence/infrastructure/typeorm/TypeOrmRepository.ts"],"sourcesContent":["import { Connection, EntitySchema, Repository } from 'typeorm';\nimport { AggregateRoot } from '../../../common/AggregateRoot';\nimport { Criteria } from '../../../common/criteria/Criteria';\nimport { Nullable } from '../../../common/Nullable';\nimport TypeOrmCriteriaConverter from './TypeOrmCriteriaConverter';\n\nexport abstract class TypeOrmRepository<T extends AggregateRoot> {\n    private readonly criteriaConverter = new TypeOrmCriteriaConverter();\n    constructor(private _client: Promise<Connection>) {\n    }\n\n    protected abstract entitySchema(): EntitySchema<T>;\n\n    protected client(): Promise<Connection> {\n        return this._client;\n    }\n\n    protected async repository(): Promise<Repository<T>> {\n        return (await this._client).getRepository(this.entitySchema());\n    }\n\n    protected async persist(aggregateRoot: T): Promise<void> {\n        const repository = await this.repository();\n        await repository.save(aggregateRoot as any);\n    }\n\n    public async searchByCriteria(criteria: Criteria): Promise<Nullable<T[]>> {\n        const repository = await this.repository();\n        const findOptions = this.criteriaConverter.convert(criteria);\n        return repository.find(findOptions);\n    }\n\n    public async searchOneByCriteria(criteria: Criteria): Promise<Nullable<T>> {\n        const repository = await this.repository();\n        const findOptions = this.criteriaConverter.convert(criteria);\n        return repository.findOne(findOptions);\n    }\n}\n"],"version":3}