0eda7e2e7db8372b249f09f44b740fa2
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const typeorm_1 = require("typeorm");
const FilterOperator_1 = require("../../../common/criteria/FilterOperator");
class TypeOrmCriteriaConverter {
    convert(criteria) {
        const options = {};
        if (criteria.hasOrder()) {
            options.order = {
                name: criteria.order.orderBy.value(),
                id: criteria.order.orderType.value(),
            };
        }
        if (criteria.hasPagination()) {
            options.skip = criteria.offset;
            options.take = criteria.limit;
        }
        if (criteria.hasFilters()) {
            options.where = {};
            for (const filter of criteria.filters.filters) {
                options.where[`auth_user.${filter.field.value()}`] = this.buildWhereCondition(filter);
            }
        }
        return options;
    }
    buildWhereCondition(filter) {
        switch (filter.operator.value()) {
            case FilterOperator_1.Operator.EQUAL:
                return (0, typeorm_1.Raw)(() => `${filter.field.value()} = '${filter.value.toString()}%'`);
            case FilterOperator_1.Operator.NOT_EQUAL:
                return (0, typeorm_1.Not)((0, typeorm_1.Equal)(filter.value));
            case FilterOperator_1.Operator.GT:
                return (0, typeorm_1.MoreThan)(filter.value);
            case FilterOperator_1.Operator.GT_OR_EQUAL:
                return (0, typeorm_1.MoreThanOrEqual)(filter.value);
            case FilterOperator_1.Operator.LT:
                return (0, typeorm_1.LessThan)(filter.value);
            case FilterOperator_1.Operator.LT_OR_EQUAL:
                return (0, typeorm_1.LessThanOrEqual)(filter.value);
            case FilterOperator_1.Operator.LIKE:
                return (0, typeorm_1.Like)(filter.value);
            // case Operator.CONTAINS:
            //     return In<string>(filter.value);
            default:
                return filter.value;
        }
    }
}
exports.default = TypeOrmCriteriaConverter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2N1YXRyb29jaGVudGEvTWFnaWNTaG9wcGVyL21hZ2ljc2hvcHBlci1ub2RlL3NyYy9taWNyb2svcGVyc2lzdGVuY2UvaW5mcmFzdHJ1Y3R1cmUvdHlwZW9ybS9UeXBlT3JtQ3JpdGVyaWFDb252ZXJ0ZXIudHMiLCJtYXBwaW5ncyI6Ijs7QUFDQSxxQ0FBc0c7QUFHdEcsNEVBQW1FO0FBRW5FLE1BQXFCLHdCQUF3QjtJQUNsQyxPQUFPLENBQUMsUUFBa0I7UUFDN0IsTUFBTSxPQUFPLEdBQTZCLEVBQUUsQ0FBQztRQUU3QyxJQUFJLFFBQVEsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNyQixPQUFPLENBQUMsS0FBSyxHQUFHO2dCQUNaLElBQUksRUFBRSxRQUFRLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Z0JBQ3BDLEVBQUUsRUFBRSxRQUFRLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUU7YUFDdkMsQ0FBQztTQUNMO1FBRUQsSUFBSSxRQUFRLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDMUIsT0FBTyxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO1lBQy9CLE9BQU8sQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQztTQUNqQztRQUVELElBQUksUUFBUSxDQUFDLFVBQVUsRUFBRSxFQUFFO1lBQ3ZCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1lBQ25CLEtBQUssTUFBTSxNQUFNLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUU7Z0JBQzNDLE9BQU8sQ0FBQyxLQUFLLENBQUMsYUFBYSxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDekY7U0FDSjtRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7SUFFTyxtQkFBbUIsQ0FBQyxNQUFjO1FBQ3RDLFFBQVEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUM3QixLQUFLLHlCQUFRLENBQUMsS0FBSztnQkFDZixPQUFPLElBQUEsYUFBRyxFQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsT0FBTyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNoRixLQUFLLHlCQUFRLENBQUMsU0FBUztnQkFDbkIsT0FBTyxJQUFBLGFBQUcsRUFBQyxJQUFBLGVBQUssRUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNwQyxLQUFLLHlCQUFRLENBQUMsRUFBRTtnQkFDWixPQUFPLElBQUEsa0JBQVEsRUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEMsS0FBSyx5QkFBUSxDQUFDLFdBQVc7Z0JBQ3JCLE9BQU8sSUFBQSx5QkFBZSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6QyxLQUFLLHlCQUFRLENBQUMsRUFBRTtnQkFDWixPQUFPLElBQUEsa0JBQVEsRUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbEMsS0FBSyx5QkFBUSxDQUFDLFdBQVc7Z0JBQ3JCLE9BQU8sSUFBQSx5QkFBZSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6QyxLQUFLLHlCQUFRLENBQUMsSUFBSTtnQkFDZCxPQUFPLElBQUEsY0FBSSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QiwwQkFBMEI7WUFDMUIsdUNBQXVDO1lBQ3ZDO2dCQUNJLE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQztTQUMzQjtJQUNMLENBQUM7Q0FDSjtBQWhERCwyQ0FnREMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL2N1YXRyb29jaGVudGEvTWFnaWNTaG9wcGVyL21hZ2ljc2hvcHBlci1ub2RlL3NyYy9taWNyb2svcGVyc2lzdGVuY2UvaW5mcmFzdHJ1Y3R1cmUvdHlwZW9ybS9UeXBlT3JtQ3JpdGVyaWFDb252ZXJ0ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmluZE1hbnlPcHRpb25zIH0gZnJvbSAndHlwZW9ybS9maW5kLW9wdGlvbnMvRmluZE1hbnlPcHRpb25zJztcbmltcG9ydCB7IEVxdWFsLCBMZXNzVGhhbiwgTGVzc1RoYW5PckVxdWFsLCBMaWtlLCBNb3JlVGhhbiwgTW9yZVRoYW5PckVxdWFsLCBOb3QsIFJhdyB9IGZyb20gJ3R5cGVvcm0nO1xuaW1wb3J0IHsgQ3JpdGVyaWEgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vY3JpdGVyaWEvQ3JpdGVyaWEnO1xuaW1wb3J0IHsgRmlsdGVyIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2NyaXRlcmlhL0ZpbHRlcic7XG5pbXBvcnQgeyBPcGVyYXRvciB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9jcml0ZXJpYS9GaWx0ZXJPcGVyYXRvcic7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFR5cGVPcm1Dcml0ZXJpYUNvbnZlcnRlciB7XG4gICAgcHVibGljIGNvbnZlcnQoY3JpdGVyaWE6IENyaXRlcmlhKTogRmluZE1hbnlPcHRpb25zPHVua25vd24+IHtcbiAgICAgICAgY29uc3Qgb3B0aW9uczogRmluZE1hbnlPcHRpb25zPHVua25vd24+ID0ge307XG5cbiAgICAgICAgaWYgKGNyaXRlcmlhLmhhc09yZGVyKCkpIHtcbiAgICAgICAgICAgIG9wdGlvbnMub3JkZXIgPSB7XG4gICAgICAgICAgICAgICAgbmFtZTogY3JpdGVyaWEub3JkZXIub3JkZXJCeS52YWx1ZSgpLFxuICAgICAgICAgICAgICAgIGlkOiBjcml0ZXJpYS5vcmRlci5vcmRlclR5cGUudmFsdWUoKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3JpdGVyaWEuaGFzUGFnaW5hdGlvbigpKSB7XG4gICAgICAgICAgICBvcHRpb25zLnNraXAgPSBjcml0ZXJpYS5vZmZzZXQ7XG4gICAgICAgICAgICBvcHRpb25zLnRha2UgPSBjcml0ZXJpYS5saW1pdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjcml0ZXJpYS5oYXNGaWx0ZXJzKCkpIHtcbiAgICAgICAgICAgIG9wdGlvbnMud2hlcmUgPSB7fTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsdGVyIG9mIGNyaXRlcmlhLmZpbHRlcnMuZmlsdGVycykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMud2hlcmVbYGF1dGhfdXNlci4ke2ZpbHRlci5maWVsZC52YWx1ZSgpfWBdID0gdGhpcy5idWlsZFdoZXJlQ29uZGl0aW9uKGZpbHRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICB9XG5cbiAgICBwcml2YXRlIGJ1aWxkV2hlcmVDb25kaXRpb24oZmlsdGVyOiBGaWx0ZXIpOiBhbnkge1xuICAgICAgICBzd2l0Y2ggKGZpbHRlci5vcGVyYXRvci52YWx1ZSgpKSB7XG4gICAgICAgICAgICBjYXNlIE9wZXJhdG9yLkVRVUFMOlxuICAgICAgICAgICAgICAgIHJldHVybiBSYXcoKCkgPT4gYCR7ZmlsdGVyLmZpZWxkLnZhbHVlKCl9ID0gJyR7ZmlsdGVyLnZhbHVlLnRvU3RyaW5nKCl9JSdgKTtcbiAgICAgICAgICAgIGNhc2UgT3BlcmF0b3IuTk9UX0VRVUFMOlxuICAgICAgICAgICAgICAgIHJldHVybiBOb3QoRXF1YWwoZmlsdGVyLnZhbHVlKSk7XG4gICAgICAgICAgICBjYXNlIE9wZXJhdG9yLkdUOlxuICAgICAgICAgICAgICAgIHJldHVybiBNb3JlVGhhbihmaWx0ZXIudmFsdWUpO1xuICAgICAgICAgICAgY2FzZSBPcGVyYXRvci5HVF9PUl9FUVVBTDpcbiAgICAgICAgICAgICAgICByZXR1cm4gTW9yZVRoYW5PckVxdWFsKGZpbHRlci52YWx1ZSk7XG4gICAgICAgICAgICBjYXNlIE9wZXJhdG9yLkxUOlxuICAgICAgICAgICAgICAgIHJldHVybiBMZXNzVGhhbihmaWx0ZXIudmFsdWUpO1xuICAgICAgICAgICAgY2FzZSBPcGVyYXRvci5MVF9PUl9FUVVBTDpcbiAgICAgICAgICAgICAgICByZXR1cm4gTGVzc1RoYW5PckVxdWFsKGZpbHRlci52YWx1ZSk7XG4gICAgICAgICAgICBjYXNlIE9wZXJhdG9yLkxJS0U6XG4gICAgICAgICAgICAgICAgcmV0dXJuIExpa2UoZmlsdGVyLnZhbHVlKTtcbiAgICAgICAgICAgIC8vIGNhc2UgT3BlcmF0b3IuQ09OVEFJTlM6XG4gICAgICAgICAgICAvLyAgICAgcmV0dXJuIEluPHN0cmluZz4oZmlsdGVyLnZhbHVlKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlci52YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==